# importing image object from PIL
import math
from PIL import Image, ImageDraw
  
# Data is in the format: (pid, tag, tstart, tend)
HEIGHT = 20
MARGIN = 0

# Agent 8:
# A* Total nodes = 6272
NUMPROCS = 8
data = [
	[0,1,104.967000,106.745000], [0,1,2032.027000,2033.163000], [0,1,2626.090000,2630.086000], [0,1,2897.922000,2898.966000], [0,1,3996.180000,3997.271000], [0,1,4408.345000,4409.550000], [0,1,4550.972000,4552.171000], [0,0,4627.771000,4642.713000], [0,1,6296.813000,6297.954000], [0,1,8426.264000,8427.548000], [0,1,9212.777000,9213.802000], [0,1,10687.786000,10689.131000], [0,1,10835.238000,10836.268000], [0,1,11723.519000,11724.934000], [0,0,12513.814000,12529.296000], [0,1,13007.224000,13008.713000], [0,1,13900.276000,13901.885000], [0,1,14576.708000,14577.851000], [0,1,16451.215000,16452.351000], [0,1,17361.752000,17362.914000], [0,1,17579.704000,17923.237000], [0,1,27059.560000,27075.066000], [0,0,27815.298000,27850.667000], [0,0,28012.091000,28013.316000], [0,2,28167.924000,33352.010000], [0,4,35104.149000,38826.451000], [0,1,38871.857000,38873.013000], [0,1,39074.182000,39076.392000], [0,1,39268.070000,39285.217000], [0,1,39299.345000,39314.402000], [0,1,39453.585000,39455.208000], [0,1,40018.218000,40030.621000], [0,1,40695.756000,40706.141000], [0,1,40826.901000,40828.811000], [0,1,40955.041000,40956.574000], [0,1,41107.344000,41118.950000], [0,1,41422.114000,41423.137000], [0,1,41604.364000,41605.404000], [0,1,41848.748000,41850.065000], [0,1,41910.496000,41926.404000], [0,1,42382.348000,42383.557000], [0,1,42390.147000,42391.203000], [0,1,42435.798000,42436.981000], [0,2,42734.176000,45932.784000], [0,4,47402.821000,47508.390000], 
	[1,1,102.190000,103.366000], [1,1,3913.485000,3914.624000], [1,1,5312.556000,5313.934000], [1,1,6290.564000,6291.981000], [1,1,6402.644000,6403.877000], [1,1,6771.035000,6772.097000], [1,1,8595.672000,8596.715000], [1,1,9118.843000,9119.937000], [1,0,10907.284000,10923.736000], [1,1,11384.149000,11385.481000], [1,1,15702.491000,15703.727000], [1,1,16151.655000,16152.785000], [1,1,17578.528000,17921.950000], [1,1,21649.913000,21650.936000], [1,0,23675.169000,27813.381000], [1,2,33177.347000,33352.010000], [1,4,35104.729000,38826.451000], [1,1,38835.856000,38837.423000], [1,1,39268.172000,39282.777000], [1,0,39520.687000,39536.778000], [1,1,40018.533000,40029.681000], [1,1,40029.950000,40031.381000], [1,1,40708.144000,40828.469000], [1,1,40828.737000,40830.073000], [1,1,40946.329000,40948.118000], [1,1,41035.099000,41036.267000], [1,1,41107.637000,41117.918000], [1,1,41244.824000,41245.901000], [1,1,41382.064000,41383.571000], [1,1,41480.984000,41483.077000], [1,1,41560.481000,41561.750000], [1,1,41722.857000,41724.756000], [1,1,41906.498000,41908.005000], [1,1,42124.530000,42125.763000], [1,1,42133.630000,42235.674000], [1,1,42235.904000,42237.113000], [1,1,42235.904000,42237.730000], [1,1,42238.988000,42240.890000], [1,1,42550.625000,42552.493000], [1,1,42557.775000,42559.096000], [1,1,42738.346000,45931.303000], [1,2,42738.346000,45932.784000], [1,4,47402.866000,47508.390000], 
	[2,0,3322.377000,3338.735000], [2,1,4147.054000,4148.313000], [2,1,9422.520000,9423.626000], [2,0,9832.746000,9849.137000], [2,0,11602.579000,11619.278000], [2,1,11764.988000,11766.038000], [2,1,12513.813000,12530.491000], [2,1,14464.094000,14465.794000], [2,1,17578.237000,17975.488000], [2,1,19454.461000,23667.400000], [2,2,28160.809000,33352.010000], [2,4,38826.274000,38826.451000], [2,1,40510.569000,40511.600000], [2,1,40537.700000,40539.276000], [2,1,40691.364000,40692.554000], [2,1,40708.285000,40827.555000], [2,1,40827.833000,40829.245000], [2,1,40989.724000,40990.768000], [2,1,41107.897000,41121.044000], [2,1,41143.406000,41144.723000], [2,1,41299.110000,41300.177000], [2,1,41387.803000,41404.432000], [2,1,41708.056000,41709.230000], [2,1,41911.417000,41925.792000], [2,1,42045.355000,42046.364000], [2,0,42054.799000,42062.228000], [2,2,45932.559000,45932.784000], [2,4,47508.260000,47508.390000], 
	[3,1,71.942000,75.601000], [3,1,137.211000,139.303000], [3,1,2963.610000,2964.650000], [3,1,3733.970000,3736.072000], [3,0,4336.056000,4351.622000], [3,1,4807.076000,4808.355000], [3,1,7130.799000,7131.864000], [3,1,8328.423000,8329.924000], [3,1,10893.208000,10894.479000], [3,1,10962.594000,10963.658000], [3,1,11012.509000,11013.555000], [3,1,12951.287000,12952.389000], [3,1,13647.317000,13648.550000], [3,1,15170.532000,15171.603000], [3,1,16880.097000,16881.414000], [3,1,17575.049000,17920.620000], [3,1,18481.300000,18482.400000], [3,1,18974.070000,18975.154000], [3,1,23664.824000,23687.010000], [3,2,31062.864000,33352.010000], [3,4,35104.966000,38826.451000], [3,1,41142.670000,41143.688000], [3,1,42445.651000,42461.288000], [3,2,45931.704000,45932.784000], [3,4,47403.159000,47508.390000], 
	[4,1,1840.268000,1841.431000], [4,1,3569.670000,3570.756000], [4,1,5544.857000,5545.880000], [4,1,6643.901000,6645.159000], [4,1,10834.526000,10835.546000], [4,1,11307.530000,11309.439000], [4,1,14083.865000,14085.285000], [4,1,15170.783000,15172.066000], [4,1,15186.878000,15188.134000], [4,1,15371.512000,15372.540000], [4,1,17363.082000,17364.156000], [4,1,17580.342000,17922.911000], [4,1,19033.158000,19034.397000], [4,2,28888.558000,33352.010000], [4,4,35104.505000,38826.451000], [4,1,38835.871000,38837.013000], [4,1,39268.448000,39283.256000], [4,0,39299.342000,39314.447000], [4,1,39741.458000,39742.588000], [4,1,39747.742000,39749.050000], [4,1,39928.284000,39929.477000], [4,1,39945.197000,39946.481000], [4,1,40015.912000,40032.129000], [4,1,40186.957000,40188.163000], [4,1,40420.274000,40421.292000], [4,1,40421.788000,40422.922000], [4,1,40452.075000,40453.779000], [4,1,40477.861000,40479.595000], [4,1,40598.701000,40600.667000], [4,1,40694.234000,40831.936000], [4,1,41055.001000,41056.265000], [4,1,41073.462000,41074.851000], [4,1,41103.696000,41104.752000], [4,1,41155.826000,41156.994000], [4,1,41167.992000,41169.301000], [4,1,41208.221000,41210.252000], [4,1,41341.902000,41343.628000], [4,1,41361.206000,41362.383000], [4,1,41408.776000,41410.013000], [4,1,41446.775000,41448.315000], [4,1,41460.957000,41462.097000], [4,1,41491.958000,41493.133000], [4,1,41553.596000,41555.005000], [4,1,41561.259000,41562.613000], [4,1,41580.408000,41581.471000], [4,1,41624.478000,41625.914000], [4,1,41675.114000,41676.336000], [4,1,41708.207000,41709.976000], [4,1,41795.898000,41797.281000], [4,1,41907.273000,41927.471000], [4,1,42008.184000,42009.996000], [4,1,42046.020000,42047.218000], [4,1,42077.897000,42079.322000], [4,1,42123.290000,42124.325000], [4,1,42344.702000,42345.770000], [4,1,42375.195000,42376.748000], [4,1,42382.840000,42384.662000], [4,1,42410.892000,42412.006000], [4,1,42422.643000,42423.781000], [4,1,42483.928000,42485.032000], [4,1,42638.567000,42641.441000], [4,1,42647.983000,42649.170000], [4,1,42685.782000,42686.963000], [4,1,42687.446000,42688.662000], [4,2,45931.809000,45932.784000], [4,4,47402.831000,47508.390000], 
	[5,1,99.249000,100.381000], [5,1,1892.191000,1893.971000], [5,1,2095.156000,2096.370000], [5,1,2309.737000,2310.738000], [5,1,3243.985000,3245.071000], [5,1,3443.579000,3444.840000], [5,1,3791.995000,3793.077000], [5,1,4138.331000,4139.378000], [5,1,4928.559000,4929.632000], [5,1,5377.024000,5378.425000], [5,1,6626.145000,6628.248000], [5,1,6683.550000,6684.648000], [5,1,9103.201000,9104.317000], [5,1,10774.962000,10776.045000], [5,0,11602.582000,11619.272000], [5,1,11724.305000,11725.369000], [5,1,13006.887000,13007.948000], [5,1,13107.822000,13108.914000], [5,1,14464.122000,14465.382000], [5,1,14506.758000,14507.879000], [5,1,15193.827000,15194.985000], [5,1,16111.290000,16112.560000], [5,1,17579.264000,17921.232000], [5,1,18260.492000,18262.141000], [5,0,18626.130000,18628.116000], [5,1,18995.305000,18996.462000], [5,1,20059.902000,20061.064000], [5,2,28158.385000,33352.010000], [5,4,35104.302000,38826.451000], [5,1,38835.861000,38837.972000], [5,1,39783.671000,39784.884000], [5,1,39813.690000,39814.694000], [5,1,40013.871000,40015.403000], [5,1,40057.239000,40058.549000], [5,1,40174.678000,40175.758000], [5,1,40221.504000,40223.979000], [5,1,40519.410000,40520.557000], [5,1,40684.049000,40685.311000], [5,1,40696.161000,40827.930000], [5,1,40947.306000,40948.706000], [5,1,40972.578000,40973.852000], [5,1,41072.122000,41073.791000], [5,1,41102.334000,41103.916000], [5,1,41108.337000,41120.124000], [5,1,41126.660000,41143.239000], [5,1,41156.353000,41158.217000], [5,1,41253.504000,41255.480000], [5,1,41316.956000,41318.781000], [5,1,41345.493000,41346.558000], [5,1,41353.427000,41355.938000], [5,1,41481.838000,41483.490000], [5,1,41520.171000,41521.210000], [5,1,41579.465000,41580.728000], [5,1,41624.060000,41625.502000], [5,1,41625.755000,41628.615000], [5,1,41758.389000,41760.038000], [5,1,41760.417000,41761.648000], [5,1,41768.249000,41769.266000], [5,1,41788.384000,41790.134000], [5,1,41847.424000,41848.934000], [5,1,41907.972000,41927.035000], [5,1,42005.702000,42007.058000], [5,1,42238.075000,42239.313000], [5,1,42245.321000,42246.345000], [5,1,42356.444000,42358.759000], [5,1,42398.584000,42399.928000], [5,1,42411.927000,42412.937000], [5,1,42506.873000,42508.300000], [5,0,42626.113000,42627.641000], [5,1,42736.586000,42737.952000], [5,2,45931.927000,45932.784000], [5,4,47402.890000,47508.390000], 
	[6,1,72.359000,74.432000], [6,1,104.471000,105.679000], [6,1,249.773000,250.809000], [6,1,3727.978000,3729.111000], [6,1,4163.927000,4180.116000], [6,1,4579.056000,4580.242000], [6,1,6290.520000,6291.692000], [6,1,10515.705000,10516.891000], [6,0,10907.316000,10923.446000], [6,1,11723.390000,11724.526000], [6,1,12042.116000,12043.366000], [6,0,12606.128000,12622.961000], [6,0,12890.109000,12906.601000], [6,1,14876.516000,14877.732000], [6,1,17575.153000,17922.462000], [6,1,21265.107000,21266.118000], [6,1,24664.672000,24665.680000], [6,2,29171.472000,33352.010000], [6,4,35104.247000,38826.451000], [6,1,39268.707000,39284.133000], [6,1,39812.028000,39813.063000], [6,1,39837.285000,39838.599000], [6,1,39847.792000,39848.936000], [6,1,40017.381000,40030.056000], [6,1,40144.557000,40145.909000], [6,1,40338.344000,40339.702000], [6,1,40362.451000,40363.503000], [6,1,40368.916000,40370.187000], [6,1,40376.497000,40377.832000], [6,1,40422.901000,40424.209000], [6,1,40496.042000,40497.224000], [6,1,40503.026000,40504.167000], [6,1,40692.090000,40693.174000], [6,1,40708.635000,40827.026000], [6,1,40837.177000,40839.150000], [6,1,41046.069000,41047.543000], [6,1,41084.563000,41085.802000], [6,1,41107.831000,41118.521000], [6,0,41126.729000,41143.579000], [6,1,41155.490000,41156.496000], [6,1,41175.238000,41176.529000], [6,1,41208.351000,41209.507000], [6,1,41272.801000,41274.129000], [6,1,41334.882000,41336.376000], [6,1,41381.474000,41382.492000], [6,1,41382.735000,41384.658000], [6,1,41460.113000,41461.120000], [6,1,41480.081000,41481.885000], [6,1,41533.171000,41534.541000], [6,1,41672.606000,41673.685000], [6,1,41709.164000,41711.377000], [6,1,41904.465000,41905.486000], [6,1,41910.012000,41927.859000], [6,1,41933.893000,41935.542000], [6,1,41955.117000,41956.344000], [6,1,42059.072000,42060.145000], [6,1,42098.860000,42100.635000], [6,1,42237.279000,42239.963000], [6,1,42280.594000,42281.941000], [6,1,42287.906000,42289.195000], [6,1,42326.864000,42327.896000], [6,1,42389.965000,42391.664000], [6,1,42397.803000,42398.855000], [6,1,42399.338000,42400.699000], [6,1,42435.579000,42438.187000], [6,1,42445.713000,42462.373000], [6,1,42485.912000,42487.268000], [6,1,42646.600000,42648.018000], [6,2,45932.033000,45932.784000], [6,4,47402.878000,47508.390000], 
	[7,1,71.402000,73.129000], [7,1,100.684000,102.192000], [7,1,103.285000,105.067000], [7,1,138.940000,140.153000], [7,1,3680.795000,3681.852000], [7,1,3733.912000,3735.131000], [7,1,3896.258000,3897.674000], [7,0,3926.843000,3941.912000], [7,0,4363.630000,4379.209000], [7,1,5312.426000,5313.441000], [7,0,6405.433000,6420.749000], [7,1,6645.003000,6646.025000], [7,1,6961.958000,6963.752000], [7,1,9883.057000,9884.639000], [7,1,10626.082000,10627.636000], [7,1,10704.515000,10705.555000], [7,1,10961.676000,10962.851000], [7,1,11005.900000,11006.913000], [7,1,12389.904000,12390.974000], [7,1,13899.838000,13901.006000], [7,1,14486.327000,14487.592000], [7,1,15376.418000,15378.072000], [7,1,15543.079000,15544.135000], [7,1,15697.393000,15698.418000], [7,1,17577.450000,17921.629000], [7,1,19000.767000,19001.977000], [7,1,20987.705000,20989.039000], [7,1,25098.449000,25099.763000], [7,2,33351.507000,33352.010000], [7,4,35104.235000,38826.451000], [7,1,39110.552000,39111.869000], [7,1,39259.750000,39260.881000], [7,1,39264.709000,39265.719000], [7,1,39282.662000,39284.608000], [7,0,39299.362000,39314.437000], [7,1,39352.075000,39353.224000], [7,1,39558.222000,39559.291000], [7,1,39979.250000,39980.277000], [7,1,40014.529000,40031.628000], [7,1,40067.664000,40069.264000], [7,1,40164.255000,40165.271000], [7,1,40169.890000,40171.881000], [7,1,40181.485000,40182.680000], [7,1,40251.237000,40253.275000], [7,1,40463.212000,40464.251000], [7,1,40572.964000,40574.172000], [7,1,40597.644000,40598.807000], [7,1,40694.987000,40830.475000], [7,1,40956.294000,40957.344000], [7,1,41074.681000,41076.627000], [7,1,41106.728000,41117.239000], [7,1,41144.023000,41145.743000], [7,1,41146.179000,41147.420000], [7,1,41207.130000,41208.300000], [7,1,41216.096000,41217.451000], [7,1,41245.740000,41247.309000], [7,1,41260.691000,41261.739000], [7,1,41343.340000,41345.255000], [7,1,41371.673000,41372.989000], [7,1,41380.330000,41381.887000], [7,1,41409.342000,41410.776000], [7,1,41423.266000,41424.397000], [7,1,41532.815000,41535.124000], [7,1,41542.153000,41543.387000], [7,1,41622.595000,41624.097000], [7,1,41689.326000,41690.876000], [7,1,41723.127000,41725.532000], [7,1,41744.501000,41745.822000], [7,1,41860.173000,41861.372000], [7,1,41905.422000,41906.686000], [7,1,41911.190000,41926.705000], [7,1,41927.016000,41928.760000], [7,1,41954.736000,41955.767000], [7,1,42239.243000,42240.420000], [7,1,42437.725000,42439.072000], [7,1,42485.006000,42486.239000], [7,1,42505.664000,42507.029000], [7,1,42632.134000,42633.781000], [7,1,42685.413000,42689.155000], [7,1,42726.758000,42728.477000], [7,2,45932.147000,45932.784000], [7,4,47402.841000,47508.390000], 
]
# Total, block, % = 47509.250000, 76331.737000, 160.667106 %
# Num nodes = 33470; 4065 (12.1 %), 3522 (10.5 %), 3133 (9.4 %), 4543 (13.6 %), 4698 (14.0 %), 4713 (14.1 %), 4725 (14.1 %), 4071 (12.2 %), 
TMAX = int(47509.250)

SCALE = 1000/TMAX

# Color Dict
tagColor = {
    0:"red", # buffer access
    1:"green", # checking if finished
    2:"blue", # synch main
    3:"purple", # verification
    4:"orange", # synch exit
}

# Get max time
if(TMAX<0):
    for datum in data:
        TMAX = int(datum[3]*SCALE) if int(datum[3]*SCALE)>TMAX else TMAX
TMAX = int(SCALE*TMAX)

# Set up frame
w,h = TMAX, HEIGHT*NUMPROCS
img = Image.new("RGB", (w,h))
img1 = ImageDraw.Draw(img)  
img1.rectangle([0,0,w,h], fill ='white')

# Set up timelines
for i in range(0,NUMPROCS):
    img1.rectangle([0,i*HEIGHT,TMAX,(i+1)*HEIGHT-MARGIN], fill ='white', outline='black')

# Add blocks
sumByTag = {}
sumTotal = 0
for datum in data:
    x1 = int(datum[2]*SCALE)
    y1 = HEIGHT * datum[0]
    x2 = int(datum[3]*SCALE)
    y2 = y1+HEIGHT-MARGIN
    img1.rectangle([x1,y1+1,x2,y2-1], fill =tagColor[datum[1]], outline =None)
    
    sumTotal += datum[3]-datum[2]
    if(datum[1] in sumByTag):
        sumByTag[datum[1]] += datum[3]-datum[2]
    else:
        sumByTag[datum[1]] = datum[3]-datum[2]

print('Blockage by tag:')
for key in sumByTag:
    print(f'\tTag {key}: {sumByTag[key]}, {100*sumByTag[key]/sumTotal}')

# Save
img.save('../outputs/timeline.png')
